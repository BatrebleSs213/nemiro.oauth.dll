<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- @SortOrder 2 -->
<html xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp">
  <head>
    <title>Custom client</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="Language" content="en-us" />
    <link rel="SHORTCUT ICON" href="./../icons/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="./../styles/branding.css" />
    <link rel="stylesheet" type="text/css" href="./../styles/branding-en-US.css" />
  <link type='text/css' rel='stylesheet' href='styles/highlight.css' /><script type='text/javascript' src='scripts/highlight_ac.js'></script></head>
  <body class="primary-mtps-offline-document">
    <div class="OH_outerDiv">
      <div class="OH_outerContent">
        <div id="mainSection">
          <div id="mainBody">
            <h1>Creating OAuth client</h1>
            <p>Create a new client for <b>OAuth</b> is very simple!</p>

            <p><a><strong>1. Use one of two basic classes:</strong></a></p>
            <ul>
              <li><b>OAuthClient</b> for <b>OAuth 1.0</b></li>
              <li><b>OAuth2Client</b> for <b>OAuth 2.0</b></li>
            </ul>
            <p><b>NOTE:</b> If the provider supports both versions of the protocol. recommended to use <b>OAuth 2.0</b> (<b>OAuth2Client</b> class).</p>

            <p><a><strong>2. Specify a unique name of the client.</strong></a></p>
            <div class="highlight-title"><span class="highlight-copycode" onkeypress="javascript:CopyColorizedCodeCheckKey(this.parentNode, event);" onmouseover="CopyCodeChangeIcon(this)" onmouseout="CopyCodeChangeIcon(this)" onclick="javascript:CopyColorizedCode(this.parentNode);"><img src="icons/CopyCode.gif" style="margin-right: 5px;" />Copy</span>C#</div><pre class="highlight-pre"><span class="highlight-spacerShort"></span><span class="highlight-comment">/// &lt;summary&gt;</span>
<span class="highlight-spacerShort"></span><span class="highlight-comment">/// Unique provider name: &lt;b&gt;NewClient&lt;/b&gt;.</span>
<span class="highlight-spacerShort"></span><span class="highlight-comment">/// &lt;/summary&gt;</span>
<span class="highlight-spacerShort"></span><span class="highlight-keyword">public</span> <span class="highlight-keyword">override</span> <span class="highlight-keyword">string</span> ProviderName
<span class="highlight-spacerShort"></span>{
<span class="highlight-spacerShort"></span>  <span class="highlight-keyword">get</span>
<span class="highlight-spacerShort"></span>  {
<span class="highlight-spacerShort"></span>    <span class="highlight-keyword">return</span> <span class="highlight-literal">&quot;NewClient&quot;</span>;
<span class="highlight-spacerShort"></span>  }
<span class="highlight-spacerShort"></span>}</pre>

            <p><a><strong>3. In the constructor, specify the base address for authorization and the address for obtaining the access token.</strong></a></p>
            <p>This information can be found on the site of the provider.</p>
            <div class="highlight-title"><span class="highlight-copycode" onkeypress="javascript:CopyColorizedCodeCheckKey(this.parentNode, event);" onmouseover="CopyCodeChangeIcon(this)" onmouseout="CopyCodeChangeIcon(this)" onclick="javascript:CopyColorizedCode(this.parentNode);"><img src="icons/CopyCode.gif" style="margin-right: 5px;" />Copy</span>C#</div><pre class="highlight-pre"><span class="highlight-spacerShort"></span><span class="highlight-comment">/// &lt;summary&gt;</span>
<span class="highlight-spacerShort"></span><span class="highlight-comment">/// Initializes a new instance of the class.</span>
<span class="highlight-spacerShort"></span><span class="highlight-comment">/// &lt;/summary&gt;</span>
<span class="highlight-spacerShort"></span><span class="highlight-comment">/// &lt;param name=&quot;clientId&quot;&gt;The Client ID obtained from the provider website.&lt;/param&gt;</span>
<span class="highlight-spacerShort"></span><span class="highlight-comment">/// &lt;param name=&quot;clientSecret&quot;&gt;The Client Secret obtained from the provider website.&lt;/param&gt;</span>
<span class="highlight-spacerShort"></span><span class="highlight-keyword">public</span> NewClient(<span class="highlight-keyword">string</span> clientId, <span class="highlight-keyword">string</span> clientSecret) : <span class="highlight-keyword">base</span>
<span class="highlight-spacerShort"></span>(
<span class="highlight-spacerShort"></span>  <span class="highlight-literal">&quot;https://example.org/oauth&quot;</span>,
<span class="highlight-spacerShort"></span>  <span class="highlight-literal">&quot;https://example.org/oauth/access_token&quot;</span>, 
<span class="highlight-spacerShort"></span>  clientId,
<span class="highlight-spacerShort"></span>  clientSecret
<span class="highlight-spacerShort"></span>) 
<span class="highlight-spacerShort"></span>{ }</pre>

            <p><a><b>4. The hardest: overriding the GetUserInfo method.</b></a></p>
            <p>You will need to examine API of the  provider.</p>
            <p>Use the access token to work with the API.</p>
            <div class="highlight-title"><span class="highlight-copycode" onkeypress="javascript:CopyColorizedCodeCheckKey(this.parentNode, event);" onmouseover="CopyCodeChangeIcon(this)" onmouseout="CopyCodeChangeIcon(this)" onclick="javascript:CopyColorizedCode(this.parentNode);"><img src="icons/CopyCode.gif" style="margin-right: 5px;" />Copy</span>C#</div><pre class="highlight-pre"><span class="highlight-spacerShort"></span><span class="highlight-keyword">string</span> accessToken = <span class="highlight-keyword">this</span>.AccessToken[<span class="highlight-literal">&quot;access_token&quot;</span>].ToString();</pre>
            <p>You can use the <b>Helpers.ExecuteRequest</b> method to send a request to the API.</p>
            <div class="highlight-title"><span class="highlight-copycode" onkeypress="javascript:CopyColorizedCodeCheckKey(this.parentNode, event);" onmouseover="CopyCodeChangeIcon(this)" onmouseout="CopyCodeChangeIcon(this)" onclick="javascript:CopyColorizedCode(this.parentNode);"><img src="icons/CopyCode.gif" style="margin-right: 5px;" />Copy</span>C#</div><pre class="highlight-pre"><span class="highlight-spacerShort"></span><span class="highlight-comment">// query parameters</span>
<span class="highlight-spacerShort"></span><span class="highlight-keyword">var</span> parameters = <span class="highlight-keyword">new</span> NameValueCollection
<span class="highlight-spacerShort"></span>{ 
<span class="highlight-spacerShort"></span>  { <span class="highlight-literal">&quot;access_token&quot;</span> , <span class="highlight-keyword">this</span>.AccessToken[<span class="highlight-literal">&quot;access_token&quot;</span>].ToString() }
<span class="highlight-spacerShort"></span>};
<span class="highlight-spacerShort"></span>
<span class="highlight-spacerShort"></span><span class="highlight-comment">// execute the request</span>
<span class="highlight-spacerShort"></span><span class="highlight-keyword">var</span> result = Helpers.ExecuteRequest
<span class="highlight-spacerShort"></span>(
<span class="highlight-spacerShort"></span>  <span class="highlight-literal">&quot;GET&quot;</span>,
<span class="highlight-spacerShort"></span>  <span class="highlight-literal">&quot;https://api.example.com/user&quot;</span>,
<span class="highlight-spacerShort"></span>  parameters,
<span class="highlight-spacerShort"></span>  <span class="highlight-keyword">null</span>
<span class="highlight-spacerShort"></span>);</pre>
            <p>You will need transfer the user data into the UserInfo instance.</p>
            <p>You can use the <b>ApiDataMapping</b> class for mapping API results with UserInfo properties.</p>
            <p><a><strong>5. Use your client in the usual way!</strong></a></p>
            <div class="highlight-title"><span class="highlight-copycode" onkeypress="javascript:CopyColorizedCodeCheckKey(this.parentNode, event);" onmouseover="CopyCodeChangeIcon(this)" onmouseout="CopyCodeChangeIcon(this)" onclick="javascript:CopyColorizedCode(this.parentNode);"><img src="icons/CopyCode.gif" style="margin-right: 5px;" />Copy</span>C#</div><pre class="highlight-pre"><span class="highlight-spacerShort"></span>OAuthManager.RegisterClient
<span class="highlight-spacerShort"></span>(
<span class="highlight-spacerShort"></span>  <span class="highlight-keyword">new</span> NewClient
<span class="highlight-spacerShort"></span>  (
<span class="highlight-spacerShort"></span>    <span class="highlight-literal">&quot;client id&quot;</span>,
<span class="highlight-spacerShort"></span>    <span class="highlight-literal">&quot;client secret&quot;</span>
<span class="highlight-spacerShort"></span>  )
<span class="highlight-spacerShort"></span>);</pre>
            <div class="highlight-title"><span class="highlight-copycode" onkeypress="javascript:CopyColorizedCodeCheckKey(this.parentNode, event);" onmouseover="CopyCodeChangeIcon(this)" onmouseout="CopyCodeChangeIcon(this)" onclick="javascript:CopyColorizedCode(this.parentNode);"><img src="icons/CopyCode.gif" style="margin-right: 5px;" />Copy</span>C#</div><pre class="highlight-pre"><span class="highlight-spacerShort"></span><span class="highlight-keyword">string</span> url = OAuthWeb.GetAuthorizationUrl(<span class="highlight-literal">&quot;NewClient&quot;</span>);</pre>
            <p>&nbsp;</p>
            <p>If you have any problems with this, <a href="https://github.com/alekseynemiro/nemiro.oauth.dll/issues" target="_top">let me know</a>.</p>
          </div>
        </div>
      </div>
    </div>
    <div id="OH_footer" class="OH_footer"><p><a href="http://oauth.nemiro.net" target="_top">Copyright © Aleksey Nemiro, 2014-2015</a></p></div>
  </body>
</html>